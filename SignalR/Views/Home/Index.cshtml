@{
    ViewBag.Title = "Home Page";
}

<h1>SignalR Demo!</h1>

<div class="row">

    <div class="col-md-4">
        <input type="text" placeholder="Message" data-bind="value:message" />
        <button class="btn btn-primary" data-bind="click:sendMessage">Send</button>
    </div>
    <div class="col-md-4">
        <div data-bind="foreach:messages">
            <div data-bind="text: $data"></div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/Scripts/jquery.signalR-2.1.0.min.js"></script>
    <script src="~/SignalR/hubs"></script>
    <script src="~/Scripts/knockout-3.1.0.js"></script>
    @*<script src="~/Scripts/knockout-2.3.0.js"></script>*@
    <script type="text/javascript">

        (function () {

            var perfHub = $.connection.myHub1;
            $.connection.hub.logging = true;
            $.connection.hub.start();

            perfHub.client.newMessage = function (message) {
                model.addMessage(message);
            };

            var Model = function () {
                var self = this;
                self.message = ko.observable("");
                self.messages = ko.observableArray();
            };

            Model.prototype = {

                sendMessage: function () {
                    var self = this;
                    perfHub.server.send(self.message());
                    self.message("");
                },
                addMessage: function (message) {
                    var self = this;
                    self.messages.push(message);
                }
            };

            var model = new Model();

            $(function () {
                ko.applyBindings(model);
            });

        }());

    </script>
}